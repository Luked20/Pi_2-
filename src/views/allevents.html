<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todos os Eventos</title>
    <link rel="stylesheet" href="alleventsstyles.css">
</head>
<body>
    <header class="allevents-header">
        <h1>Eventos Disponíveis</h1>
    </header>
    <main class="allevents-container">
        <!-- Os cards serão preenchidos dinamicamente pela API -->
    </main>
    <script>
       // Função para buscar eventos da API com palavra-chave
async function fetchEvents(keyword = '') {
    try {
        const url = `http://localhost:3000/getEvents?keyword=${encodeURIComponent(keyword)}`;
        const response = await fetch(url);

        if (!response.ok) {
            throw new Error("Erro ao buscar eventos");
        }

        const events = await response.json();
        const container = document.querySelector('.allevents-container');
        container.innerHTML = '';

        if (events.length === 0) {
            container.innerHTML = '<p>Nenhum evento encontrado.</p>';
            return;
        }

        // Obter o perfil do usuário
        const userProfile = JSON.parse(localStorage.getItem('userProfile')); // Assume que o perfil do usuário está no localStorage

        if (!userProfile) {
            console.log("Perfil do usuário não encontrado.");
        }

        // Verifica se o user_id não é igual a 163 para exibir o botão Admin
        const isAdmin = userProfile && userProfile.completeName === "Admin_PI";

        events.forEach(event => {
            const card = document.createElement('div');
            card.classList.add('event-card');

            const betButton = `<button class="bet-button" onclick="redirectToBetPage(${event.id})">Apostar</button>`;
            const adminButton = isAdmin ? `<button class="admin-button" onclick="redirectToAdminPage()">Admin</button>` : ''; // Botão de admin, visível apenas se o user_id não for 163

            card.innerHTML = `
                <h3>${event.title}</h3>
                <p>${event.description}</p>
                <p>Data: ${new Date(event.event_date).toLocaleDateString()}</p>
                ${betButton}
                ${adminButton}
            `;

            container.appendChild(card);
        });
    } catch (error) {
        console.error("Erro:", error);
        const container = document.querySelector('.allevents-container');
        container.innerHTML = '<p>Ocorreu um erro ao carregar os eventos. Tente novamente mais tarde.</p>';
    }
}

// Redireciona para a página de apostas com o ID do evento
function redirectToBetPage(eventId) {
    const betPageUrl = `bet.html?eventId=${eventId}`; // Adiciona o ID do evento na URL
    window.location.href = betPageUrl; // Redireciona o usuário
}

// Redireciona para a página de admin
function redirectToAdminPage() {
    window.location.href = 'admin.html'; // Redireciona o usuário para a página admin.html
}

// Carrega eventos ao abrir a página
fetchEvents();
    </script>
</body>
</html>
